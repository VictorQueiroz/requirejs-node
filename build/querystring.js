"use strict";define(function(e,n){function r(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function t(e){return e.charCodeAt(0)}var a=n,c=e("util");a.unescapeBuffer=function(e,n){for(var r,a,c,s=new Buffer(e.length),o="CHAR",i=0,u=0;i<=e.length;i++){var f=e.charCodeAt(i);switch(o){case"CHAR":switch(f){case t("%"):r=0,a=0,o="HEX0";break;case t("+"):n&&(f=t(" "));default:s[u++]=f}break;case"HEX0":if(o="HEX1",c=f,t("0")<=f&&f<=t("9"))r=f-t("0");else if(t("a")<=f&&f<=t("f"))r=f-t("a")+10;else{if(!(t("A")<=f&&f<=t("F"))){s[u++]=t("%"),s[u++]=f,o="CHAR";break}r=f-t("A")+10}break;case"HEX1":if(o="CHAR",t("0")<=f&&f<=t("9"))a=f-t("0");else if(t("a")<=f&&f<=t("f"))a=f-t("a")+10;else{if(!(t("A")<=f&&f<=t("F"))){s[u++]=t("%"),s[u++]=c,s[u++]=f;break}a=f-t("A")+10}s[u++]=16*r+a}}return s.slice(0,u-1)},a.unescape=function(e,n){try{return decodeURIComponent(e)}catch(r){return a.unescapeBuffer(e,n).toString()}},a.escape=function(e){return encodeURIComponent(e)};var s=function(e){return c.isString(e)?e:c.isBoolean(e)?e?"true":"false":c.isNumber(e)&&isFinite(e)?e:""};a.stringify=a.encode=function(e,n,r,t){n=n||"&",r=r||"=";var o=a.escape;if(t&&"function"==typeof t.encodeURIComponent&&(o=t.encodeURIComponent),c.isObject(e)){for(var i=Object.keys(e),u=[],f=0;f<i.length;f++){var p=i[f],l=e[p],d=o(s(p))+r;if(c.isArray(l))for(var h=0;h<l.length;h++)u.push(d+o(s(l[h])));else u.push(d+o(s(l)))}return u.join(n)}return""},a.parse=a.decode=function(e,n,t,s){n=n||"&",t=t||"=";var o={};if(!c.isString(e)||0===e.length)return o;var i=/\+/g;e=e.split(n);var u=1e3;s&&c.isNumber(s.maxKeys)&&(u=s.maxKeys);var f=e.length;u>0&&f>u&&(f=u);var p=a.unescape;s&&"function"==typeof s.decodeURIComponent&&(p=s.decodeURIComponent);for(var l=0;f>l;++l){var d,h,v,b,y=e[l].replace(i,"%20"),A=y.indexOf(t);A>=0?(d=y.substr(0,A),h=y.substr(A+1)):(d=y,h="");try{v=p(d),b=p(h)}catch(C){v=a.unescape(d,!0),b=a.unescape(h,!0)}r(o,v)?c.isArray(o[v])?o[v].push(b):o[v]=[o[v],b]:o[v]=b}return o}});